<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt Plugin ‚Äî AI Prompt Enhancer</title>
    <style>
        :root {
            --bg: #000000;
            --surface: #0a0a0a;
            --surface2: #1a1a1a;
            --border: #2a2a2a;
            --text: #e8e8e8;
            --text-dim: #777777;
            --accent: #ff1a1a;
            --accent2: #cc0000;
            --green: #ff3333;
            --orange: #ff4d4d;
            --red: #ff8787;
            --radius: 12px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, #0a0a0a 0%, #000000 100%);
            border-bottom: 1px solid var(--border);
            padding: 1.5rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .logo-icon {
            width: 40px; height: 40px;
            background: linear-gradient(135deg, #ff1a1a, #880000);
            border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.25rem;
        }

        .nav-links { display: flex; gap: 0.5rem; }
        .nav-links button {
            background: var(--surface);
            color: var(--text);
            border: 1px solid var(--border);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        .nav-links button:hover, .nav-links button.active {
            background: var(--accent);
            color: var(--bg);
            border-color: var(--accent);
        }

        /* Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Tabs */
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Cards */
        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .card h2 {
            font-size: 1.125rem;
            margin-bottom: 1rem;
            color: var(--accent);
        }

        /* Form Elements */
        label {
            display: block;
            font-size: 0.8rem;
            color: var(--text-dim);
            margin-bottom: 0.375rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        textarea, select, input[type="text"] {
            width: 100%;
            background: var(--bg);
            color: var(--text);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            font-size: 0.95rem;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.2s;
        }

        textarea:focus, select:focus, input:focus {
            outline: none;
            border-color: var(--accent);
        }

        textarea { min-height: 120px; }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1rem;
            margin: 1rem 0;
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ff1a1a, #990000);
            color: #fff;
        }
        .btn-primary:hover { opacity: 0.9; transform: translateY(-1px); box-shadow: 0 0 20px rgba(255, 26, 26, 0.3); }

        .btn-secondary {
            background: var(--surface2);
            color: var(--text);
        }
        .btn-secondary:hover { background: var(--border); }

        .btn-copy {
            background: #ff1a1a;
            color: #fff;
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        .btn-row { display: flex; gap: 0.75rem; margin-top: 1rem; }

        /* Result Panel */
        .result-panel {
            background: #050505;
            border: 1px solid #ff1a1a;
            border-radius: 8px;
            padding: 1.25rem;
            margin-top: 1rem;
            white-space: pre-wrap;
            line-height: 1.6;
            font-size: 0.95rem;
            max-height: 500px;
            overflow-y: auto;
        }

        .result-meta {
            display: flex;
            gap: 0.75rem;
            margin-top: 0.75rem;
            flex-wrap: wrap;
        }

        .badge {
            background: var(--surface2);
            color: var(--text-dim);
            padding: 0.25rem 0.625rem;
            border-radius: 6px;
            font-size: 0.75rem;
        }
        .badge.cat { background: #2a0000; color: #ff4d4d; }
        .badge.tech { background: #1a0000; color: #ff1a1a; }

        /* Template Grid */
        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }

        .template-card {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .template-card:hover {
            border-color: #ff1a1a;
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(255, 26, 26, 0.15);
        }
        .template-card h3 { font-size: 1rem; margin-bottom: 0.375rem; }
        .template-card p { font-size: 0.85rem; color: var(--text-dim); margin-bottom: 0.5rem; }
        .template-card .vars { font-size: 0.75rem; color: var(--accent); }

        /* History Table */
        .history-table {
            width: 100%;
            border-collapse: collapse;
        }
        .history-table th {
            text-align: left;
            padding: 0.75rem;
            background: var(--bg);
            color: var(--text-dim);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .history-table td {
            padding: 0.75rem;
            border-top: 1px solid var(--border);
            font-size: 0.9rem;
        }
        .history-table tr:hover td {
            background: rgba(255, 26, 26, 0.08);
        }

        .star-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
        }

        /* Checkbox */
        .toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0.5rem 0;
        }

        input[type="checkbox"] {
            width: 18px; height: 18px;
            accent-color: var(--accent);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .form-row { grid-template-columns: 1fr; }
            .template-grid { grid-template-columns: 1fr; }
            header { flex-direction: column; gap: 1rem; }
        }

        .empty { text-align: center; padding: 3rem; color: var(--text-dim); }

        /* Spinner */
        .spinner {
            display: inline-block;
            width: 18px; height: 18px;
            border: 2px solid #ff1a1a;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
            margin-right: 0.5rem;
            vertical-align: middle;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

<header>
    <div class="logo">
        <div class="logo-icon">üî•</div>
        <span>Prompt Plugin</span>
    </div>
    <div class="nav-links">
        <button class="active" onclick="switchTab('enhance')">Enhance</button>
        <button onclick="switchTab('templates')">Templates</button>
        <!-- <button onclick="switchTab('history')">History</button> -->
        <a href="/docs" style="text-decoration:none">
            <button>API Docs</button>
        </a>
    </div>
</header>

<div class="container">

    <!-- ‚ïê‚ïê‚ïê ENHANCE TAB ‚ïê‚ïê‚ïê -->
    <div id="tab-enhance" class="tab-content active">
        <div class="card">
            <h2>Enhance Your Prompt</h2>

            <label for="raw-prompt">Your Prompt</label>
            <textarea id="raw-prompt" placeholder="Type or paste your prompt here... e.g. 'write a python function to sort a list'"></textarea>

            <div class="form-row">
                <div>
                    <label for="tone-select">Tone</label>
                    <select id="tone-select">
                        <option value="professional">Professional</option>
                        <option value="casual">Casual</option>
                        <option value="technical">Technical</option>
                        <option value="creative">Creative</option>
                        <option value="academic">Academic</option>
                        <option value="friendly">Friendly</option>
                    </select>
                </div>
                <div>
                    <label for="category-select">Category (auto-detect)</label>
                    <select id="category-select">
                        <option value="">Auto-detect</option>
                        <option value="coding">Coding</option>
                        <option value="writing">Writing</option>
                        <option value="analysis">Analysis</option>
                        <option value="brainstorming">Brainstorming</option>
                        <option value="summarization">Summarization</option>
                        <option value="translation">Translation</option>
                        <option value="debugging">Debugging</option>
                        <option value="explanation">Explanation</option>
                        <option value="general">General</option>
                    </select>
                </div>
                <div>
                    <label for="template-select">Template (optional)</label>
                    <select id="template-select">
                        <option value="">None</option>
                    </select>
                </div>
            </div>

            <label for="context-input">Additional Context (optional)</label>
            <input type="text" id="context-input" placeholder="e.g. 'Using Python 3.12, targeting a REST API'">

            <div class="toggle">
                <input type="checkbox" id="auto-enhance" checked>
                <label for="auto-enhance" style="margin:0; text-transform:none; font-size:0.9rem; color:var(--text);">Auto-enhance prompt</label>
            </div>

            <div class="btn-row">
                <button class="btn btn-primary" onclick="enhancePrompt()" id="enhance-btn">Enhance Prompt</button>
                <button class="btn btn-secondary" onclick="clearForm()">Clear</button>
            </div>
        </div>

        <div id="result-container" style="display:none;">
            <div class="card">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h2>üéØ Enhanced Result</h2>
                    <button class="btn btn-copy" onclick="copyResult()">üìã Copy</button>
                </div>
                <div class="result-panel" id="result-text"></div>
                <div class="result-meta" id="result-meta"></div>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê TEMPLATES TAB ‚ïê‚ïê‚ïê -->
    <div id="tab-templates" class="tab-content">
        <div class="card">
            <h2>üìã Prompt Templates</h2>
            <div class="form-row" style="grid-template-columns: 1fr auto;">
                <select id="tmpl-category-filter" onchange="loadTemplates()">
                    <option value="">All Categories</option>
                    <option value="coding">Coding</option>
                    <option value="writing">Writing</option>
                    <option value="analysis">Analysis</option>
                    <option value="brainstorming">Brainstorming</option>
                    <option value="summarization">Summarization</option>
                    <option value="debugging">Debugging</option>
                    <option value="explanation">Explanation</option>
                    <option value="translation">Translation</option>
                </select>
            </div>
            <div class="template-grid" id="template-grid"></div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê HISTORY TAB ‚ïê‚ïê‚ïê -->
    <!-- <div id="tab-history" class="tab-content">
        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                <h2>Prompt History</h2>
                <div style="display:flex; gap:0.5rem;">
                    <input type="text" id="history-search" placeholder="Search..." style="width:200px;">
                    <button class="btn btn-secondary" onclick="loadHistory()">Refresh</button>
                    <button class="btn btn-secondary" style="color:var(--red);" onclick="clearHistory()">Clear All</button>
                </div>
            </div>
            <table class="history-table">
                <thead>
                    <tr>
                        <th>‚≠ê</th>
                        <th>Category</th>
                        <th>Original Prompt</th>
                        <th>Tone</th>
                        <th>Time</th>
                    </tr>
                </thead>
                <tbody id="history-body"></tbody>
            </table>
            <div id="history-empty" class="empty" style="display:none;">No history yet. Start enhancing prompts!</div>
        </div>
    </div> -->

</div>

<script>
const API = '';

// ‚îÄ‚îÄ Tab Navigation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function switchTab(tab) {
    document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.nav-links button').forEach(el => el.classList.remove('active'));
    document.getElementById(`tab-${tab}`).classList.add('active');
    event.target.classList.add('active');

    if (tab === 'templates') loadTemplates();
    if (tab === 'history') loadHistory();
}

// ‚îÄ‚îÄ Enhance ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function enhancePrompt() {
    const raw = document.getElementById('raw-prompt').value.trim();
    if (!raw) return;

    const btn = document.getElementById('enhance-btn');
    btn.innerHTML = '<span class="spinner"></span>Enhancing...';
    btn.disabled = true;

    const body = {
        raw_prompt: raw,
        tone: document.getElementById('tone-select').value,
        auto_enhance: document.getElementById('auto-enhance').checked,
    };

    const cat = document.getElementById('category-select').value;
    if (cat) body.category = cat;

    const ctx = document.getElementById('context-input').value.trim();
    if (ctx) body.context = ctx;

    const tmpl = document.getElementById('template-select').value;
    if (tmpl) body.template_id = tmpl;

    try {
        const res = await fetch(`${API}/api/enhance`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(body),
        });
        const data = await res.json();

        document.getElementById('result-text').textContent = data.enhanced;
        const meta = document.getElementById('result-meta');
        meta.innerHTML = `
            <span class="badge cat">${data.category}</span>
            <span class="badge">${data.tone}</span>
            ${data.techniques_applied.map(t => `<span class="badge tech">${t}</span>`).join('')}
        `;
        document.getElementById('result-container').style.display = 'block';
    } catch (e) {
        alert('Error: ' + e.message);
    }

    btn.innerHTML = 'Enhance Prompt';
    btn.disabled = false;
}

function copyResult() {
    const text = document.getElementById('result-text').textContent;
    navigator.clipboard.writeText(text).then(() => {
        const btn = event.target;
        btn.textContent = '‚úÖ Copied!';
        setTimeout(() => btn.textContent = 'üìã Copy', 1500);
    });
}

function clearForm() {
    document.getElementById('raw-prompt').value = '';
    document.getElementById('context-input').value = '';
    document.getElementById('result-container').style.display = 'none';
}

// ‚îÄ‚îÄ Templates ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadTemplates() {
    const cat = document.getElementById('tmpl-category-filter').value;
    const url = cat ? `${API}/api/templates?category=${cat}` : `${API}/api/templates`;
    const res = await fetch(url);
    const templates = await res.json();

    const grid = document.getElementById('template-grid');
    if (!templates.length) {
        grid.innerHTML = '<div class="empty">No templates in this category.</div>';
        return;
    }

    grid.innerHTML = templates.map(t => `
        <div class="template-card" onclick="useTemplate('${t.id}', '${t.name}')">
            <h3>${t.name}</h3>
            <p>${t.description}</p>
            <span class="badge cat">${t.category}</span>
            <div class="vars" style="margin-top:0.5rem;">Variables: ${t.variables.join(', ') || 'none'}</div>
        </div>
    `).join('');

    // Also populate template dropdown on enhance tab
    const select = document.getElementById('template-select');
    select.innerHTML = '<option value="">None</option>' +
        templates.map(t => `<option value="${t.id}">${t.name}</option>`).join('');
}

function useTemplate(id, name) {
    switchTab('enhance');
    document.querySelectorAll('.nav-links button').forEach(b => b.classList.remove('active'));
    document.querySelector('.nav-links button').classList.add('active');
    document.getElementById('template-select').value = id;
    document.getElementById('raw-prompt').placeholder = `Enter variables as JSON for "${name}"`;
    document.getElementById('raw-prompt').focus();
}

// ‚îÄ‚îÄ History ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadHistory() {
    const search = document.getElementById('history-search').value.trim();
    const url = search
        ? `${API}/api/history/search?q=${encodeURIComponent(search)}`
        : `${API}/api/history?limit=50`;

    const res = await fetch(url);
    const entries = await res.json();

    const body = document.getElementById('history-body');
    const empty = document.getElementById('history-empty');

    if (!entries.length) {
        body.innerHTML = '';
        empty.style.display = 'block';
        return;
    }
    empty.style.display = 'none';

    body.innerHTML = entries.map(e => `
        <tr>
            <td><button class="star-btn" onclick="toggleStar(${e.id})">${e.starred ? '‚≠ê' : '‚òÜ'}</button></td>
            <td><span class="badge cat">${e.category}</span></td>
            <td>${escapeHtml(e.original.substring(0, 80))}${e.original.length > 80 ? '‚Ä¶' : ''}</td>
            <td>${e.tone}</td>
            <td style="color:var(--text-dim); font-size:0.8rem;">${new Date(e.timestamp).toLocaleString()}</td>
        </tr>
    `).join('');
}

async function toggleStar(id) {
    await fetch(`${API}/api/history/${id}/star`, { method: 'POST' });
    loadHistory();
}

async function clearHistory() {
    if (!confirm('Clear all prompt history?')) return;
    await fetch(`${API}/api/history`, { method: 'DELETE' });
    loadHistory();
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('history-search').addEventListener('keyup', e => {
    if (e.key === 'Enter') loadHistory();
});

// Load templates for the dropdown
fetch(`${API}/api/templates`).then(r => r.json()).then(templates => {
    const select = document.getElementById('template-select');
    templates.forEach(t => {
        select.innerHTML += `<option value="${t.id}">${t.name}</option>`;
    });
});
</script>

</body>
</html>
